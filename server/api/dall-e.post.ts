import OpenAI from "openai";
import PromptDALLE from "@/models/PromptDALLE";
import { dataUrlToFile, uploadBlob } from "@/src/helpers/fileStorage";
import { randomUUID } from "crypto";
import authenticateRequest from "@/server/helpers/authenticateRequest";
import responseWithStatus from "@/server/helpers/responseWithStatus";
import { authErrorUnauthorized } from "@/server/errors";

export default defineEventHandler(async (event) => {
    const user = authenticateRequest(getHeader(event, "Authorization"));
    if (user) {
        const query = getQuery(event);
        const prompt = query.prompt?.toString();
        if (prompt) {
            const model = query.model?.toString();
            const dalle3 = model === "dall-e-3";
            const openai = new OpenAI({
                organization: process.env.OPENAI_ORG_ID,
                apiKey: process.env.OPENAI_API_SECRET,
            });
            const response = await openai.images.generate({
                prompt,
                n: dalle3 ? 1 : 2,
                response_format: "b64_json",
                size: dalle3 ? "1024x1024" : "256x256",
                model: dalle3 ? "dall-e-3" : "dall-e-2",
            });
            const imageSrcs: string[] = [];
            response.data.forEach((d) => {
                const src = `data:image/jpeg;base64,${d.b64_json}`;
                imageSrcs.push(src);
                const revisedPrompt = d.revised_prompt;
                const filename = `${randomUUID()}.jpg`;
                const img = dataUrlToFile(src, filename);
                if (img) {
                    uploadBlob(
                        img,
                        process.env.IMG_SAVE_DIR ?? "",
                        filename,
                        false,
                    ).then(async (success) => {
                        if (success) {
                            await PromptDALLE.create({
                                userId: user.id,
                                prompt,
                                revisedPrompt,
                                model: dalle3 ? "dall-e-3" : "dall-e-2",
                                image: filename,
                            });
                        } else {
                            console.error(
                                "Could not upload img to filestorage.",
                            );
                        }
                    });
                } else {
                    console.error(
                        "Could not generate an image file to store it.",
                    );
                }
            });
            const responseData = {
                data: response.data,
                images: imageSrcs,
                status: response.created > 0 ? 200 : 500,
                text: `Created ${response.created} image/s.`,
            };
            // const responseData = {
            //         status: 200,
            //         data: [
            //             {
            //                 b64_json: "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EgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUGn7hlf/TA6VePiO7vGHlWdH/DQzdF969b+7fR/YuX74jubz738ej+7391eXT/E9s3R/dv+Pzq6P6Pl2T//y+MnxPd/8+934juv/C166P7YxYMRffff+5L0X0vAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACg1MAtfzAiemDm6m3R/VkXfCu6f+mntkT35313VXR/wY/fE91/w8vXRfd/cOTp0f2Hnrkwuj/qylei+0sHPhDd3/DDO6P7753+WHT/jDuz389XHrwkur/mig9G970AAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSA/PumB498D/b10T3tx63I7q/cv/d0f2XT/hRdP++N/82uj950dbo/rgJb4nu37Pv9Oj+qtPGR/ef/8ay6P4/Hjcnun/Jm86I7g997mPR/fNnHRXdP+Wj743uewEAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKX+PwAA//8Du5EsfjPw4AAAAABJRU5ErkJggg=="
            //             },
            //             {
            //                 b64_json: "iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAADMElEQVR4nOzVwQnAIBQFQYXff81RUkQCOyDj1YOPnbXWPmeTRef+/3O/OyBjzh3CD95BfqICMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMO0TAAD//2Anhf4QtqobAAAAAElFTkSuQmCC"
            //             }
            //         ],
            //         images: [
            //             "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAIAAAB7GkOtAAANHklEQVR4nOzXAdfXdX3GcW+7YbjCEgRt03byyDkaWmbq5hq4MctqoDMxmxbTw+EsGKdQY3Zm6kFt7hwls0S2hnqsUYTByDo6RS2DchkisyI5LCYgkwhSRBC5I/YornM653q9HsD1+Z//+Z3zPt/B2a/ffVjS+nd8P7o/8+ld0f0N96+N7o+/+rfR/T+79cTo/rpTH47uTxz/H9H9n319W3R/09jp0f0zbzoU3d9w7M7o/oirro7uX//VedH9gc1To/vHb5oV3T88ug7A7ywBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBqcM21y6MH3vjI5Oj+2KH50f17V10Z3Z8x5U+j+2+edll0f/2sKdH9HTuviu6vXDcnuj970pbo/lFHbo3u/8vJD0T3p79lVHT/X4/7eXR/1/8tie5PnTY8uu8FAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUGvzEEUPRA+c+vDa6/+4rJkX3z9z8enT/9v/+QHR/2DXPRvdvGjUxur/622+K7p+85fro/tSffCq6f++sv4juD31yaXT/6PuXRfdHXHFddP+lEcdG9y/ddmp03wsAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACg1cPbKc6IHtm6cHd0/bf6E6P75s0+K7s+8fG90//K5l0b3z1ixNro/6a63R/effPFQdP/vpn02uj/urCXR/U0f+3V0f9Gc70X3n914WnR/7qt7ovuXrDk7uu8FAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUGpj+ng3RA8sfuCC6v37juuj+qfftju5PHnlRdP+/xj4c3V968ynR/S27rovuL/v5G6P7B0/5w+j+o7sORvfXjJsV3f/pG+ZH96d+6Jno/uiR74vu/9O1e6P7XgAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQKmBhYfdGz3wznXPRfcfv2ZEdH/n489E94fdeVV0f87nDkX3v7/6y9H910d9PLq/9K4bo/tjD7wruv/gku9F918774Ho/hN/vCi6f/jEh6L7j/3e9Oj+0xt2Rfe9AABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUoMfHjMsemDywqOj+1s33h7dv2/fT6L7O/dsj+7/YtsL0f2/HrM7un/OMQuj+8PGXh3dP2vhldH93V+ZEd3/4qKV0f3fnLc5uv836/4yur/54luj+7OnTInuewEAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUGdl48PHrgO+edFd3/ozFPRff/923PRfcHPrw3un/qeSuj+yNHL47uD4wbFt2/5+1fiO7/w4U/iO5/Z+el0f01Y4ai+7fsXxHdn7/6g9H9fW/9SHR/4cEZ0X0vAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACg1OD5dxyIHhj+z5dF9+/85a7o/stz5kb3Hx2aFt0f/fz7o/t3v/BSdH/Jk5+O7m+6bEF0/5sXfTe6f/Rtl0f3X1m9Nro/4YRTovsz14+K7k955Kjo/ue/NjG67wUAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQaXLfvXdEDb316YnT/ogPbo/uvXful6P7ob++N7k/7zJej+8f/ycnR/RePGRPd33vHoej+kWcPRfcf/bePRve/dfSe6P62jy+L7p/4yo+i+8eNXx7d//QvRkb3vQAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFKDK/59fvTAb27bEN1/4tqfRfdvfN/bovuPPbsgun/EMSui+/NuPTa6P25SdP6wpxYPj+4v+fXXo/t7DlwT3b/hpEPR/bmj5kb3n1z8SHT/l8/fEN0/eMTF0X0vAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACg1MAxix+MHhjcNDG6//eTV0f39xwaFt3/q417o/vvOHNCdP+1K/ZE94ef+JHo/gm774nuL/nVJ6P7s259Mbp/zbn7o/s3Hr8vun/Xuy+I7j/1pSuj+zfflt33AgAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASg1OOOrV6IFt52Qbs2DqO6P7X5w0M7p//7zTo/sn3/zN6P76kw5E92f+dEZ0/9UZ46P7V/159vd/9ocXRvdP+tCvovvPjc1+/yNGfya6v2rYUHT/8NtXZfej6wD8zhIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUGn7hlf/TA6VePiO7vGHlWdH/DQzdF969b+7fR/YuX74jubz738ej+7391eXT/E9s3R/dv+Pzq6P6Pl2T//y+MnxPd/8+934juv/C166P7YxYMRffff+5L0X0vAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACg1MAtfzAiemDm6m3R/VkXfCu6f+mntkT35313VXR/wY/fE91/w8vXRfd/cOTp0f2Hnrkwuj/qylei+0sHPhDd3/DDO6P7753+WHT/jDuz389XHrwkur/mig9G970AAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSA/PumB498D/b10T3tx63I7q/cv/d0f2XT/hRdP++N/82uj950dbo/rgJb4nu37Pv9Oj+qtPGR/ef/8ay6P4/Hjcnun/Jm86I7g997mPR/fNnHRXdP+Wj743uewEAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKX+PwAA//8Du5EsfjPw4AAAAABJRU5ErkJggg==",
            //             "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAADMElEQVR4nOzVwQnAIBQFQYXff81RUkQCOyDj1YOPnbXWPmeTRef+/3O/OyBjzh3CD95BfqICMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMO0TAAD//2Anhf4QtqobAAAAAElFTkSuQmCC"
            //         ],
            //         text: "Created 2 image/s."
            // };
            return responseWithStatus(event, responseData);
        } else {
            return responseWithStatus(event, {
                status: 400,
                error: "Missing prompt param.",
            });
        }
    } else {
        return responseWithStatus(event, authErrorUnauthorized);
    }
});
